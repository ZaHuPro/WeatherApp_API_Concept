import React from "react";

import Title from "./components/Title";
import Form from "./components/Form";
import Weather from "./components/Weather";

 const API_KEY_Weather = "7055fb803fe7eb7c53fc379c91c64dba";
 const API_KEY_Photo = "0f388edfe071bf3cfc4a630b874423d26ce35ca3c41da8975098ce049bf2961b";


class App extends React.Component{
  state = {
    temperature:undefined,
    city:undefined,
    country:undefined,
    humidity:undefined,
    description:undefined,
    error:undefined,
    pic_url:undefined
  }


  getWeather = async (e) => {
    e.preventDefault();
    const city = e.target.elements.city.value;
    const country = e.target.elements.country.value;
    const api_call_weather = await fetch(`http://api.openweathermap.org/data/2.5/weather?q=${city},${country}&appid=${API_KEY_Weather}&units=metric`);
    const weather_data = await api_call_weather.json();

    var API_Photo_Search = "world";

    if (city && country){
      console.log(weather_data);
      API_Photo_Search = weather_data.name;
      const api_call_photo = await fetch(`https://api.unsplash.com/search/photos?page=1&query=${API_Photo_Search}&&client_id=${API_KEY_Photo}`);
      var photo_data = await api_call_photo.json();
      console.log(photo_data.results[0].urls.full);

      this.setState({
        temperature:weather_data.main.temp,
        city: weather_data.name,
        country:weather_data.sys.country,
        humidity:weather_data.main.humidity,
        description:weather_data.weather[0].description,
        error:undefined,
        
      });

    }else{
      API_Photo_Search ="world";
      this.setState({
        temperature:undefined,
        city:undefined,
        country:undefined,
        humidity:undefined,
        description:undefined,
        error:"Location Undefined : Please enter value in the text box"
      });
    }

        // a.preventDefault();
        //  if(API_Photo_Search == ""){
        //    API_Photo_Search = "world";
        //  }
        



  }
  render(){
    return(
      <div class="subBox col">
        <Title />
        
          <Weather 
          getPhoto = {this.getPhoto}
          temperature={this.state.temperature}
          city={this.state.city}
          country={this.state.country}
          humidity={this.state.humidity}
          description={this.state.description}
          error={this.state.error}
          pic_url = {this.state.pic_url}
          />
          <Form 
          getWeather={this.getWeather}
          />
      
      </div>
    );
  }
}

export default App;